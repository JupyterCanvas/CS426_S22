Bootstrap: library
From: debian:bullseye

%files
    files/sources.list /etc/apt

%environment
    export PATH=/opt/TurboVNC/bin:$PATH

%post
    echo "Hello from inside the container"
    
    # set apt to noninteractive install
    export DEBIAN_FRONTEND=noninteractive
    
    apt update && apt upgrade -y
    apt install -y vim \
        locales \
        firefox-esr pciutils libegl-dev \
        xfce4 xfce4-terminal mousepad dbus-x11 \
        wget libegl1-mesa \
        python3-pip \
        novnc nodejs npm
    
    # set default locale
    echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
    locale-gen en_US.utf8
    update-locale LANG=en_US.UTF-8

    # set timezone
    ln -snf /usr/share/zoneinfo/America/Los_Angeles /etc/localtime
    echo America/Los_Angeles > /etc/timezone
    dpkg-reconfigure --frontend noninteractive tzdata

    # install VirtualGL for xfce
    wget https://sourceforge.net/projects/virtualgl/files/3.0/virtualgl_3.0_amd64.deb 
    dpkg -i virtualgl_3.0_amd64.deb
    rm virtualgl_3.0_amd64.deb

    # install TurboVNC VNC server
    wget https://sourceforge.net/projects/turbovnc/files/2.2.7/turbovnc_2.2.7_amd64.deb
    dpkg -i turbovnc_2.2.7_amd64.deb
    rm turbovnc_2.2.7_amd64.deb
    export PATH=/opt/TurboVNC/bin:$PATH

    # install JupyterLab
    pip install jupyterlab



%runscript
    echo "This is what happens when you run the container..."
